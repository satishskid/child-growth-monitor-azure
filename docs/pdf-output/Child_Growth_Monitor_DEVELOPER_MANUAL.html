<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Child Growth Monitor Team" />
  <title>Child Growth Monitor - Developer Manual</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="github.css" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">Child Growth Monitor - Developer Manual</h1>
<p class="subtitle">Technical Documentation and Development Guide</p>
<p class="author">Child Growth Monitor Team</p>
<p class="date">July 2025</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#child-growth-monitor---developer-manual"
id="toc-child-growth-monitor---developer-manual"><span
class="toc-section-number">1</span> Child Growth Monitor - Developer
Manual</a>
<ul>
<li><a href="#table-of-contents" id="toc-table-of-contents"><span
class="toc-section-number">1.1</span> Table of Contents</a></li>
<li><a href="#architecture-overview"
id="toc-architecture-overview"><span
class="toc-section-number">1.2</span> Architecture Overview</a>
<ul>
<li><a href="#system-architecture" id="toc-system-architecture"><span
class="toc-section-number">1.2.1</span> System Architecture</a></li>
<li><a href="#technology-stack" id="toc-technology-stack"><span
class="toc-section-number">1.2.2</span> Technology Stack</a></li>
<li><a href="#data-flow" id="toc-data-flow"><span
class="toc-section-number">1.2.3</span> Data Flow</a></li>
</ul></li>
<li><a href="#development-environment-setup"
id="toc-development-environment-setup"><span
class="toc-section-number">1.3</span> Development Environment Setup</a>
<ul>
<li><a href="#prerequisites" id="toc-prerequisites"><span
class="toc-section-number">1.3.1</span> Prerequisites</a></li>
<li><a href="#quick-setup" id="toc-quick-setup"><span
class="toc-section-number">1.3.2</span> Quick Setup</a></li>
<li><a href="#detailed-setup" id="toc-detailed-setup"><span
class="toc-section-number">1.3.3</span> Detailed Setup</a></li>
<li><a href="#environment-configuration"
id="toc-environment-configuration"><span
class="toc-section-number">1.3.4</span> Environment
Configuration</a></li>
<li><a href="#vs-code-configuration"
id="toc-vs-code-configuration"><span
class="toc-section-number">1.3.5</span> VS Code Configuration</a></li>
</ul></li>
<li><a href="#mobile-app-development"
id="toc-mobile-app-development"><span
class="toc-section-number">1.4</span> Mobile App Development</a>
<ul>
<li><a href="#project-structure" id="toc-project-structure"><span
class="toc-section-number">1.4.1</span> Project Structure</a></li>
<li><a href="#key-components" id="toc-key-components"><span
class="toc-section-number">1.4.2</span> Key Components</a></li>
<li><a href="#camera-integration" id="toc-camera-integration"><span
class="toc-section-number">1.4.3</span> Camera Integration</a></li>
<li><a href="#offline-data-management"
id="toc-offline-data-management"><span
class="toc-section-number">1.4.4</span> Offline Data Management</a></li>
<li><a href="#state-management" id="toc-state-management"><span
class="toc-section-number">1.4.5</span> State Management</a></li>
</ul></li>
<li><a href="#backend-api-development"
id="toc-backend-api-development"><span
class="toc-section-number">1.5</span> Backend API Development</a>
<ul>
<li><a href="#project-structure-1" id="toc-project-structure-1"><span
class="toc-section-number">1.5.1</span> Project Structure</a></li>
<li><a href="#database-models" id="toc-database-models"><span
class="toc-section-number">1.5.2</span> Database Models</a></li>
<li><a href="#api-routes" id="toc-api-routes"><span
class="toc-section-number">1.5.3</span> API Routes</a></li>
<li><a href="#authentication-middleware"
id="toc-authentication-middleware"><span
class="toc-section-number">1.5.4</span> Authentication
Middleware</a></li>
<li><a href="#data-encryption" id="toc-data-encryption"><span
class="toc-section-number">1.5.5</span> Data Encryption</a></li>
</ul></li>
<li><a href="#ml-service-development"
id="toc-ml-service-development"><span
class="toc-section-number">1.6</span> ML Service Development</a>
<ul>
<li><a href="#architecture" id="toc-architecture"><span
class="toc-section-number">1.6.1</span> Architecture</a></li>
<li><a href="#project-structure-2" id="toc-project-structure-2"><span
class="toc-section-number">1.6.2</span> Project Structure</a></li>
<li><a href="#real-ml-implementation"
id="toc-real-ml-implementation"><span
class="toc-section-number">1.6.3</span> Real ML Implementation</a></li>
<li><a href="#pose-estimation" id="toc-pose-estimation"><span
class="toc-section-number">1.6.4</span> Pose Estimation</a></li>
<li><a href="#who-growth-standards-integration"
id="toc-who-growth-standards-integration"><span
class="toc-section-number">1.6.5</span> WHO Growth Standards
Integration</a></li>
<li><a href="#fastapi-service-implementation"
id="toc-fastapi-service-implementation"><span
class="toc-section-number">1.6.6</span> FastAPI Service
Implementation</a></li>
</ul></li>
<li><a href="#database-management" id="toc-database-management"><span
class="toc-section-number">1.7</span> Database Management</a>
<ul>
<li><a href="#schema-design" id="toc-schema-design"><span
class="toc-section-number">1.7.1</span> Schema Design</a></li>
<li><a href="#database-initialization"
id="toc-database-initialization"><span
class="toc-section-number">1.7.2</span> Database Initialization</a></li>
<li><a href="#migrations" id="toc-migrations"><span
class="toc-section-number">1.7.3</span> Migrations</a></li>
</ul></li>
<li><a href="#security-implementation"
id="toc-security-implementation"><span
class="toc-section-number">1.8</span> Security Implementation</a>
<ul>
<li><a href="#data-encryption-1" id="toc-data-encryption-1"><span
class="toc-section-number">1.8.1</span> Data Encryption</a></li>
<li><a href="#authentication-authorization"
id="toc-authentication-authorization"><span
class="toc-section-number">1.8.2</span> Authentication &amp;
Authorization</a></li>
<li><a href="#audit-logging" id="toc-audit-logging"><span
class="toc-section-number">1.8.3</span> Audit Logging</a></li>
</ul></li>
<li><a href="#testing-strategies" id="toc-testing-strategies"><span
class="toc-section-number">1.9</span> Testing Strategies</a>
<ul>
<li><a href="#unit-testing" id="toc-unit-testing"><span
class="toc-section-number">1.9.1</span> Unit Testing</a></li>
<li><a href="#integration-testing" id="toc-integration-testing"><span
class="toc-section-number">1.9.2</span> Integration Testing</a></li>
<li><a href="#end-to-end-testing" id="toc-end-to-end-testing"><span
class="toc-section-number">1.9.3</span> End-to-End Testing</a></li>
</ul></li>
<li><a href="#deployment-guide" id="toc-deployment-guide"><span
class="toc-section-number">1.10</span> Deployment Guide</a>
<ul>
<li><a href="#docker-configuration" id="toc-docker-configuration"><span
class="toc-section-number">1.10.1</span> Docker Configuration</a></li>
<li><a href="#docker-compose" id="toc-docker-compose"><span
class="toc-section-number">1.10.2</span> Docker Compose</a></li>
<li><a href="#azure-deployment" id="toc-azure-deployment"><span
class="toc-section-number">1.10.3</span> Azure Deployment</a></li>
<li><a href="#environment-configuration-1"
id="toc-environment-configuration-1"><span
class="toc-section-number">1.10.4</span> Environment
Configuration</a></li>
</ul></li>
<li><a href="#api-documentation" id="toc-api-documentation"><span
class="toc-section-number">1.11</span> API Documentation</a>
<ul>
<li><a href="#authentication-endpoints"
id="toc-authentication-endpoints"><span
class="toc-section-number">1.11.1</span> Authentication
Endpoints</a></li>
<li><a href="#child-management-endpoints"
id="toc-child-management-endpoints"><span
class="toc-section-number">1.11.2</span> Child Management
Endpoints</a></li>
<li><a href="#ml-analysis-endpoints"
id="toc-ml-analysis-endpoints"><span
class="toc-section-number">1.11.3</span> ML Analysis Endpoints</a></li>
</ul></li>
<li><a href="#troubleshooting" id="toc-troubleshooting"><span
class="toc-section-number">1.12</span> Troubleshooting</a>
<ul>
<li><a href="#common-development-issues"
id="toc-common-development-issues"><span
class="toc-section-number">1.12.1</span> Common Development
Issues</a></li>
<li><a href="#performance-optimization"
id="toc-performance-optimization"><span
class="toc-section-number">1.12.2</span> Performance
Optimization</a></li>
<li><a href="#monitoring-and-logging"
id="toc-monitoring-and-logging"><span
class="toc-section-number">1.12.3</span> Monitoring and Logging</a></li>
</ul></li>
<li><a href="#contributing-guidelines"
id="toc-contributing-guidelines"><span
class="toc-section-number">1.13</span> Contributing Guidelines</a>
<ul>
<li><a href="#code-standards" id="toc-code-standards"><span
class="toc-section-number">1.13.1</span> Code Standards</a></li>
<li><a href="#git-workflow" id="toc-git-workflow"><span
class="toc-section-number">1.13.2</span> Git Workflow</a></li>
<li><a href="#commit-message-format"
id="toc-commit-message-format"><span
class="toc-section-number">1.13.3</span> Commit Message Format</a></li>
<li><a href="#pull-request-process" id="toc-pull-request-process"><span
class="toc-section-number">1.13.4</span> Pull Request Process</a></li>
<li><a href="#testing-requirements" id="toc-testing-requirements"><span
class="toc-section-number">1.13.5</span> Testing Requirements</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
<h1 data-number="1" id="child-growth-monitor---developer-manual"><span
class="header-section-number">1</span> Child Growth Monitor - Developer
Manual</h1>
<h2 data-number="1.1" id="table-of-contents"><span
class="header-section-number">1.1</span> Table of Contents</h2>
<ol type="1">
<li><a href="#architecture-overview">Architecture Overview</a></li>
<li><a href="#development-environment-setup">Development Environment
Setup</a></li>
<li><a href="#mobile-app-development">Mobile App Development</a></li>
<li><a href="#backend-api-development">Backend API Development</a></li>
<li><a href="#ml-service-development">ML Service Development</a></li>
<li><a href="#database-management">Database Management</a></li>
<li><a href="#security-implementation">Security Implementation</a></li>
<li><a href="#testing-strategies">Testing Strategies</a></li>
<li><a href="#deployment-guide">Deployment Guide</a></li>
<li><a href="#api-documentation">API Documentation</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#contributing-guidelines">Contributing Guidelines</a></li>
</ol>
<h2 data-number="1.2" id="architecture-overview"><span
class="header-section-number">1.2</span> Architecture Overview</h2>
<h3 data-number="1.2.1" id="system-architecture"><span
class="header-section-number">1.2.1</span> System Architecture</h3>
<p>The Child Growth Monitor is built as a microservices architecture
with three main components:</p>
<pre><code>┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Mobile App    │    │  Backend API    │    │   ML Service    │
│  (React Native) │◄──►│    (Flask)      │◄──►│   (FastAPI)     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │              ┌─────────────────┐              │
         │              │    Database     │              │
         └──────────────►│  (PostgreSQL)   │◄─────────────┘
                        └─────────────────┘</code></pre>
<h3 data-number="1.2.2" id="technology-stack"><span
class="header-section-number">1.2.2</span> Technology Stack</h3>
<h4 data-number="1.2.2.1" id="mobile-application"><span
class="header-section-number">1.2.2.1</span> Mobile Application</h4>
<ul>
<li><strong>Framework</strong>: React Native with Expo</li>
<li><strong>Language</strong>: TypeScript</li>
<li><strong>Navigation</strong>: React Navigation v6</li>
<li><strong>State Management</strong>: React Context API</li>
<li><strong>Storage</strong>: AsyncStorage + SQLite</li>
<li><strong>Camera</strong>: Expo Camera with ARKit/ARCore</li>
<li><strong>Networking</strong>: Fetch API with retry logic</li>
</ul>
<h4 data-number="1.2.2.2" id="backend-api"><span
class="header-section-number">1.2.2.2</span> Backend API</h4>
<ul>
<li><strong>Framework</strong>: Flask with SQLAlchemy</li>
<li><strong>Language</strong>: Python 3.9+</li>
<li><strong>Database</strong>: PostgreSQL (SQLite for development)</li>
<li><strong>Authentication</strong>: JWT tokens</li>
<li><strong>Encryption</strong>: Fernet symmetric encryption</li>
<li><strong>File Storage</strong>: Azure Blob Storage</li>
<li><strong>Documentation</strong>: OpenAPI/Swagger</li>
</ul>
<h4 data-number="1.2.2.3" id="ml-service"><span
class="header-section-number">1.2.2.3</span> ML Service</h4>
<ul>
<li><strong>Framework</strong>: FastAPI</li>
<li><strong>Language</strong>: Python 3.9+</li>
<li><strong>Computer Vision</strong>: OpenCV, MediaPipe</li>
<li><strong>Machine Learning</strong>: scikit-learn, TensorFlow</li>
<li><strong>Image Processing</strong>: PIL, NumPy</li>
<li><strong>Growth Standards</strong>: WHO reference data</li>
<li><strong>Documentation</strong>: Auto-generated OpenAPI</li>
</ul>
<h4 data-number="1.2.2.4" id="infrastructure"><span
class="header-section-number">1.2.2.4</span> Infrastructure</h4>
<ul>
<li><strong>Containerization</strong>: Docker with Docker Compose</li>
<li><strong>Cloud Platform</strong>: Azure (with AWS/GCP support)</li>
<li><strong>CI/CD</strong>: GitHub Actions</li>
<li><strong>Monitoring</strong>: Azure Monitor, Application
Insights</li>
<li><strong>Authentication</strong>: Azure B2C</li>
</ul>
<h3 data-number="1.2.3" id="data-flow"><span
class="header-section-number">1.2.3</span> Data Flow</h3>
<ol type="1">
<li><strong>Mobile App</strong> captures child images using camera</li>
<li><strong>Image Processing</strong> converts to base64 and
compresses</li>
<li><strong>Backend API</strong> handles authentication and data
storage</li>
<li><strong>ML Service</strong> processes images for anthropometric
analysis</li>
<li><strong>WHO Standards</strong> calculate growth percentiles and
nutritional status</li>
<li><strong>Results</strong> returned to mobile app for display</li>
<li><strong>Data Sync</strong> handles offline/online
synchronization</li>
</ol>
<h2 data-number="1.3" id="development-environment-setup"><span
class="header-section-number">1.3</span> Development Environment
Setup</h2>
<h3 data-number="1.3.1" id="prerequisites"><span
class="header-section-number">1.3.1</span> Prerequisites</h3>
<h4 data-number="1.3.1.1" id="system-requirements"><span
class="header-section-number">1.3.1.1</span> System Requirements</h4>
<ul>
<li><strong>Operating System</strong>: macOS, Linux, or Windows
10/11</li>
<li><strong>Node.js</strong>: Version 16.0 or higher</li>
<li><strong>Python</strong>: Version 3.9 or higher</li>
<li><strong>Git</strong>: Latest version</li>
<li><strong>Docker</strong>: Latest version (optional but
recommended)</li>
</ul>
<h4 data-number="1.3.1.2" id="development-tools"><span
class="header-section-number">1.3.1.2</span> Development Tools</h4>
<ul>
<li><strong>IDE</strong>: Visual Studio Code (recommended)</li>
<li><strong>Mobile Testing</strong>: iOS Simulator (macOS) or Android
Emulator</li>
<li><strong>API Testing</strong>: Postman or similar</li>
<li><strong>Database</strong>: PostgreSQL (or SQLite for local
development)</li>
</ul>
<h3 data-number="1.3.2" id="quick-setup"><span
class="header-section-number">1.3.2</span> Quick Setup</h3>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clone the repository</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/your-org/child-growth-monitor.git</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> child-growth-monitor</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Install global dependencies</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install <span class="at">-g</span> @expo/cli</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install virtualenv</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup all services</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="ex">./setup.sh</span></span></code></pre></div>
<h3 data-number="1.3.3" id="detailed-setup"><span
class="header-section-number">1.3.3</span> Detailed Setup</h3>
<h4 data-number="1.3.3.1" id="mobile-app-setup"><span
class="header-section-number">1.3.3.1</span> 1. Mobile App Setup</h4>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Navigate to mobile app directory</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> mobile-app</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Install dependencies</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Install iOS dependencies (macOS only)</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ios <span class="kw">&amp;&amp;</span> <span class="ex">pod</span> install <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> ..</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix common issues</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> expo install <span class="at">--fix</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Start development server</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> start</span></code></pre></div>
<h4 data-number="1.3.3.2" id="backend-api-setup"><span
class="header-section-number">1.3.3.2</span> 2. Backend API Setup</h4>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Navigate to backend directory</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> backend</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create virtual environment</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> venv venv</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> venv/bin/activate  <span class="co"># On Windows: venv\Scripts\activate</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Install dependencies</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements.txt</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize database</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> init_db.py init</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Start development server</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> app.py</span></code></pre></div>
<h4 data-number="1.3.3.3" id="ml-service-setup"><span
class="header-section-number">1.3.3.3</span> 3. ML Service Setup</h4>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Navigate to ML service directory</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ml-service</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create virtual environment</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> venv venv-real</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> venv-real/bin/activate</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Install ML dependencies</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements-real.txt</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Start ML service</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> main_real.py</span></code></pre></div>
<h3 data-number="1.3.4" id="environment-configuration"><span
class="header-section-number">1.3.4</span> Environment
Configuration</h3>
<h4 data-number="1.3.4.1" id="environment-variables"><span
class="header-section-number">1.3.4.1</span> Environment Variables</h4>
<p>Create <code>.env</code> files in each service directory:</p>
<p><strong>Mobile App (mobile-app/.env)</strong></p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="va">API_BASE_URL</span><span class="op">=</span>http://localhost:5002/api</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="va">ML_SERVICE_URL</span><span class="op">=</span>http://localhost:8001</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="va">ENABLE_REAL_ML</span><span class="op">=</span>true</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="va">MOCK_MODE</span><span class="op">=</span>false</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="va">DEV_MODE</span><span class="op">=</span>true</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="va">SKIP_AUTH</span><span class="op">=</span>true</span></code></pre></div>
<p><strong>Backend API (backend/.env)</strong></p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="va">FLASK_ENV</span><span class="op">=</span>development</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="va">FLASK_DEBUG</span><span class="op">=</span>True</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="va">DATABASE_URL</span><span class="op">=</span>sqlite:///cgm_development.db</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="va">SECRET_KEY</span><span class="op">=</span>your-secret-key-here</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="va">ENCRYPTION_KEY</span><span class="op">=</span>your-encryption-key-here</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="va">AZURE_STORAGE_ACCOUNT</span><span class="op">=</span>your-storage-account</span></code></pre></div>
<p><strong>ML Service (ml-service/.env)</strong></p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="va">MODEL_PATH</span><span class="op">=</span>./models</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="va">LOG_LEVEL</span><span class="op">=</span>DEBUG</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="va">ENABLE_GPU</span><span class="op">=</span>false</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="va">WHO_STANDARDS_PATH</span><span class="op">=</span>./data/who_standards.json</span></code></pre></div>
<h3 data-number="1.3.5" id="vs-code-configuration"><span
class="header-section-number">1.3.5</span> VS Code Configuration</h3>
<h4 data-number="1.3.5.1" id="recommended-extensions"><span
class="header-section-number">1.3.5.1</span> Recommended Extensions</h4>
<div class="sourceCode" id="cb9"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;recommendations&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ms-python.python&quot;</span><span class="ot">,</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ms-python.pylance&quot;</span><span class="ot">,</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ms-vscode.vscode-typescript-next&quot;</span><span class="ot">,</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;bradlc.vscode-tailwindcss&quot;</span><span class="ot">,</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ms-vscode.vscode-expo&quot;</span><span class="ot">,</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ms-azuretools.vscode-docker&quot;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 data-number="1.3.5.2" id="tasks-configuration"><span
class="header-section-number">1.3.5.2</span> Tasks Configuration</h4>
<p>The project includes VS Code tasks for common operations:</p>
<ul>
<li><strong>Start Mobile App</strong>: <code>Cmd+Shift+P</code> →
“Tasks: Run Task” → “Start Mobile App (Expo)”</li>
<li><strong>Start Backend</strong>: “Start Backend Server”</li>
<li><strong>Start ML Service</strong>: “Start ML Service”</li>
<li><strong>Type Check</strong>: “Type Check Mobile App”</li>
</ul>
<h2 data-number="1.4" id="mobile-app-development"><span
class="header-section-number">1.4</span> Mobile App Development</h2>
<h3 data-number="1.4.1" id="project-structure"><span
class="header-section-number">1.4.1</span> Project Structure</h3>
<pre><code>mobile-app/
├── src/
│   ├── components/          # Reusable UI components
│   ├── screens/            # App screens
│   │   ├── WelcomeScreen.tsx
│   │   ├── LoginScreen.tsx
│   │   ├── HomeScreen.tsx
│   │   ├── ConsentScreen.tsx
│   │   ├── ScanningScreen.tsx
│   │   └── ResultsScreen.tsx
│   ├── services/           # API and business logic
│   │   ├── AuthService.tsx
│   │   ├── DataService.tsx
│   │   └── MLService.ts
│   ├── types/              # TypeScript type definitions
│   └── utils/              # Utility functions
├── assets/                 # Images, fonts, etc.
├── App.tsx                 # Main app component
└── package.json           # Dependencies and scripts</code></pre>
<h3 data-number="1.4.2" id="key-components"><span
class="header-section-number">1.4.2</span> Key Components</h3>
<h4 data-number="1.4.2.1" id="authentication-service"><span
class="header-section-number">1.4.2.1</span> Authentication Service</h4>
<div class="sourceCode" id="cb11"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">// src/services/AuthService.tsx</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> useAuth <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [token<span class="op">,</span> setToken] <span class="op">=</span> <span class="fu">useState</span><span class="op">&lt;</span><span class="dt">string</span> <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;</span>(<span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [user<span class="op">,</span> setUser] <span class="op">=</span> <span class="fu">useState</span><span class="op">&lt;</span>User <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;</span>(<span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> login <span class="op">=</span> <span class="kw">async</span> (credentials<span class="op">:</span> LoginCredentials) <span class="kw">=&gt;</span> {</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="vs">`</span><span class="sc">${</span>API_BASE_URL<span class="sc">}</span><span class="vs">/auth/login`</span><span class="op">,</span> {</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>      method<span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>      headers<span class="op">:</span> { <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;application/json&#39;</span> }<span class="op">,</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>      body<span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(credentials)<span class="op">,</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (response<span class="op">.</span><span class="at">ok</span>) {</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setToken</span>(data<span class="op">.</span><span class="at">token</span>)<span class="op">;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setUser</span>(data<span class="op">.</span><span class="at">user</span>)<span class="op">;</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> AsyncStorage<span class="op">.</span><span class="fu">setItem</span>(<span class="st">&#39;auth_token&#39;</span><span class="op">,</span> data<span class="op">.</span><span class="at">token</span>)<span class="op">;</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... other auth methods</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<h4 data-number="1.4.2.2" id="ml-service-integration"><span
class="header-section-number">1.4.2.2</span> ML Service Integration</h4>
<div class="sourceCode" id="cb12"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">// src/services/MLService.ts</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">class</span> MLService {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">analyzeImage</span>(request<span class="op">:</span> MLAnalysisRequest)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>MLAnalysisResponse <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;</span> {</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">makeRequest</span>(<span class="st">&#39;/analyze&#39;</span><span class="op">,</span> {</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        method<span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        headers<span class="op">:</span> { <span class="st">&#39;Content-Type&#39;</span><span class="op">:</span> <span class="st">&#39;application/json&#39;</span> }<span class="op">,</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        body<span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>({</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>          image_data<span class="op">:</span> request<span class="op">.</span><span class="at">image_data</span><span class="op">,</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>          age_months<span class="op">:</span> request<span class="op">.</span><span class="at">age_months</span><span class="op">,</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>          sex<span class="op">:</span> request<span class="op">.</span><span class="at">sex</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        })<span class="op">,</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">handleOfflineAnalysis</span>(request)<span class="op">;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 data-number="1.4.3" id="camera-integration"><span
class="header-section-number">1.4.3</span> Camera Integration</h3>
<div class="sourceCode" id="cb13"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ScanningScreen.tsx</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { Camera } <span class="im">from</span> <span class="st">&#39;expo-camera&#39;</span><span class="op">;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> ScanningScreen <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [hasPermission<span class="op">,</span> setHasPermission] <span class="op">=</span> <span class="fu">useState</span><span class="op">&lt;</span><span class="dt">boolean</span> <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;</span>(<span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [camera<span class="op">,</span> setCamera] <span class="op">=</span> <span class="fu">useState</span><span class="op">&lt;</span>Camera <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;</span>(<span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">useEffect</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> { status } <span class="op">=</span> <span class="cf">await</span> Camera<span class="op">.</span><span class="fu">requestCameraPermissionsAsync</span>()<span class="op">;</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setHasPermission</span>(status <span class="op">===</span> <span class="st">&#39;granted&#39;</span>)<span class="op">;</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    })()<span class="op">;</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> [])<span class="op">;</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> takePicture <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (camera) {</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> photo <span class="op">=</span> <span class="cf">await</span> camera<span class="op">.</span><span class="fu">takePictureAsync</span>({</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        quality<span class="op">:</span> <span class="fl">0.8</span><span class="op">,</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        base64<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        skipProcessing<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Process image and send to ML service</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="fu">processAndAnalyze</span>(photo)<span class="op">;</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<h3 data-number="1.4.4" id="offline-data-management"><span
class="header-section-number">1.4.4</span> Offline Data Management</h3>
<div class="sourceCode" id="cb14"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">// src/services/DataService.tsx</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> storeOfflineAction <span class="op">=</span> <span class="kw">async</span> (action<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> data<span class="op">:</span> <span class="dt">any</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> offlineQueue <span class="op">=</span> <span class="cf">await</span> AsyncStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;offline_queue&#39;</span>) <span class="op">||</span> <span class="st">&#39;[]&#39;</span><span class="op">;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> queue <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(offlineQueue)<span class="op">;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  queue<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    action<span class="op">,</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    data<span class="op">,</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">toISOString</span>()<span class="op">,</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> AsyncStorage<span class="op">.</span><span class="fu">setItem</span>(<span class="st">&#39;offline_queue&#39;</span><span class="op">,</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(queue))<span class="op">;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> syncOfflineData <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> offlineQueue <span class="op">=</span> <span class="cf">await</span> AsyncStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;offline_queue&#39;</span>) <span class="op">||</span> <span class="st">&#39;[]&#39;</span><span class="op">;</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> queue <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(offlineQueue)<span class="op">;</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> item <span class="kw">of</span> queue) {</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="fu">processOfflineAction</span>(item)<span class="op">;</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">warn</span>(<span class="st">&#39;Sync failed for item:&#39;</span><span class="op">,</span> item<span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<h3 data-number="1.4.5" id="state-management"><span
class="header-section-number">1.4.5</span> State Management</h3>
<div class="sourceCode" id="cb15"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Context-based state management</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> AppContext <span class="op">=</span> <span class="fu">createContext</span><span class="op">&lt;</span>AppContextType <span class="op">|</span> <span class="dt">undefined</span><span class="op">&gt;</span>(<span class="kw">undefined</span>)<span class="op">;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> AppProvider<span class="op">:</span> React<span class="op">.</span><span class="at">FC</span><span class="op">&lt;</span>{children<span class="op">:</span> ReactNode}<span class="op">&gt;</span> <span class="op">=</span> ({ children }) <span class="kw">=&gt;</span> {</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [children<span class="op">,</span> setChildren] <span class="op">=</span> <span class="fu">useState</span><span class="op">&lt;</span>Child[]<span class="op">&gt;</span>([])<span class="op">;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [currentUser<span class="op">,</span> setCurrentUser] <span class="op">=</span> <span class="fu">useState</span><span class="op">&lt;</span>User <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;</span>(<span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [isOffline<span class="op">,</span> setIsOffline] <span class="op">=</span> <span class="fu">useState</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Network status monitoring</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">useEffect</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> unsubscribe <span class="op">=</span> NetInfo<span class="op">.</span><span class="fu">addEventListener</span>(state <span class="kw">=&gt;</span> {</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setIsOffline</span>(<span class="op">!</span>state<span class="op">.</span><span class="at">isConnected</span>)<span class="op">;</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> unsubscribe<span class="op">;</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> [])<span class="op">;</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> value <span class="op">=</span> {</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    children<span class="op">,</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    setChildren<span class="op">,</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    currentUser<span class="op">,</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    setCurrentUser<span class="op">,</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    isOffline<span class="op">,</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">&lt;</span>AppContext<span class="op">.</span><span class="at">Provider</span> value<span class="op">=</span>{value}<span class="op">&gt;</span>{children}<span class="op">&lt;/</span>AppContext<span class="op">.</span><span class="at">Provider</span><span class="op">&gt;;</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<h2 data-number="1.5" id="backend-api-development"><span
class="header-section-number">1.5</span> Backend API Development</h2>
<h3 data-number="1.5.1" id="project-structure-1"><span
class="header-section-number">1.5.1</span> Project Structure</h3>
<pre><code>backend/
├── backend_app/
│   ├── __init__.py         # App factory
│   ├── config.py           # Configuration settings
│   ├── extensions.py       # SQLAlchemy, etc.
│   ├── models/             # Database models
│   │   ├── __init__.py
│   │   ├── user.py
│   │   ├── child.py
│   │   ├── consent.py
│   │   └── scan_session.py
│   ├── routes/             # API endpoints
│   │   ├── __init__.py
│   │   ├── auth.py
│   │   ├── children.py
│   │   ├── consent.py
│   │   └── scans.py
│   ├── middleware/         # Security middleware
│   └── utils/              # Utilities
├── app.py                  # Application entry point
├── init_db.py             # Database initialization
└── requirements.txt       # Python dependencies</code></pre>
<h3 data-number="1.5.2" id="database-models"><span
class="header-section-number">1.5.2</span> Database Models</h3>
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># backend_app/models/child.py</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlalchemy_utils <span class="im">import</span> EncryptedType</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlalchemy_utils.types.encrypted.encrypted_type <span class="im">import</span> AesEngine</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Child(db.Model):</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    __tablename__ <span class="op">=</span> <span class="st">&#39;children&#39;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span> <span class="op">=</span> db.Column(db.String(<span class="dv">36</span>), primary_key<span class="op">=</span><span class="va">True</span>, default<span class="op">=</span><span class="kw">lambda</span>: <span class="bu">str</span>(uuid.uuid4()))</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Encrypted PII</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> db.Column(EncryptedType(db.String(<span class="dv">100</span>), secret_key, AesEngine, <span class="st">&#39;pkcs5&#39;</span>))</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    date_of_birth <span class="op">=</span> db.Column(EncryptedType(db.Date, secret_key, AesEngine, <span class="st">&#39;pkcs5&#39;</span>))</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Non-PII</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    gender <span class="op">=</span> db.Column(db.String(<span class="dv">1</span>))  <span class="co"># &#39;M&#39; or &#39;F&#39;</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    organization_id <span class="op">=</span> db.Column(db.String(<span class="dv">36</span>), db.ForeignKey(<span class="st">&#39;organizations.id&#39;</span>))</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    created_at <span class="op">=</span> db.Column(db.DateTime, default<span class="op">=</span>datetime.utcnow)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    updated_at <span class="op">=</span> db.Column(db.DateTime, default<span class="op">=</span>datetime.utcnow, onupdate<span class="op">=</span>datetime.utcnow)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Relationships</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    scan_sessions <span class="op">=</span> db.relationship(<span class="st">&#39;ScanSession&#39;</span>, backref<span class="op">=</span><span class="st">&#39;child&#39;</span>, lazy<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    consents <span class="op">=</span> db.relationship(<span class="st">&#39;Consent&#39;</span>, backref<span class="op">=</span><span class="st">&#39;child&#39;</span>, lazy<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<h3 data-number="1.5.3" id="api-routes"><span
class="header-section-number">1.5.3</span> API Routes</h3>
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># backend_app/routes/children.py</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask <span class="im">import</span> Blueprint, request, jsonify</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask_jwt_extended <span class="im">import</span> jwt_required, get_jwt_identity</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>children_bp <span class="op">=</span> Blueprint(<span class="st">&#39;children&#39;</span>, <span class="va">__name__</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="at">@children_bp.route</span>(<span class="st">&#39;/children&#39;</span>, methods<span class="op">=</span>[<span class="st">&#39;POST&#39;</span>])</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="at">@jwt_required</span>()</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_child():</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> request.get_json()</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate input</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">all</span>(k <span class="kw">in</span> data <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">&#39;name&#39;</span>, <span class="st">&#39;date_of_birth&#39;</span>, <span class="st">&#39;gender&#39;</span>]):</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jsonify({<span class="st">&#39;error&#39;</span>: <span class="st">&#39;Missing required fields&#39;</span>}), <span class="dv">400</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create child record</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    child <span class="op">=</span> Child(</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span>data[<span class="st">&#39;name&#39;</span>],</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>        date_of_birth<span class="op">=</span>datetime.strptime(data[<span class="st">&#39;date_of_birth&#39;</span>], <span class="st">&#39;%Y-%m-</span><span class="sc">%d</span><span class="st">&#39;</span>).date(),</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>        gender<span class="op">=</span>data[<span class="st">&#39;gender&#39;</span>],</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>        organization_id<span class="op">=</span>get_jwt_identity()[<span class="st">&#39;organization_id&#39;</span>]</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    db.session.add(child)</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    db.session.commit()</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jsonify({</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;success&#39;</span>: <span class="va">True</span>,</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;data&#39;</span>: child.to_dict()</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    }), <span class="dv">201</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="at">@children_bp.route</span>(<span class="st">&#39;/children&#39;</span>, methods<span class="op">=</span>[<span class="st">&#39;GET&#39;</span>])</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a><span class="at">@jwt_required</span>()</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> list_children():</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    user_identity <span class="op">=</span> get_jwt_identity()</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>    children <span class="op">=</span> Child.query.filter_by(</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>        organization_id<span class="op">=</span>user_identity[<span class="st">&#39;organization_id&#39;</span>]</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    ).<span class="bu">all</span>()</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jsonify({</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;success&#39;</span>: <span class="va">True</span>,</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;data&#39;</span>: [child.to_dict() <span class="cf">for</span> child <span class="kw">in</span> children]</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>    })</span></code></pre></div>
<h3 data-number="1.5.4" id="authentication-middleware"><span
class="header-section-number">1.5.4</span> Authentication
Middleware</h3>
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># backend_app/middleware/security.py</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> wraps</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask_jwt_extended <span class="im">import</span> verify_jwt_in_request, get_jwt_identity</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> require_role(required_role):</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> decorator(f):</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">@wraps</span>(f)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> decorated_function(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>            verify_jwt_in_request()</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>            current_user <span class="op">=</span> get_jwt_identity()</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> current_user[<span class="st">&#39;role&#39;</span>] <span class="op">!=</span> required_role:</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> jsonify({<span class="st">&#39;error&#39;</span>: <span class="st">&#39;Insufficient permissions&#39;</span>}), <span class="dv">403</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> f(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> decorated_function</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> decorator</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> audit_log(action):</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> decorator(f):</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">@wraps</span>(f)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> decorated_function(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> f(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Log the action</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>            log_audit_event(</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>                user_id<span class="op">=</span>get_jwt_identity()[<span class="st">&#39;user_id&#39;</span>],</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>                action<span class="op">=</span>action,</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>                resource<span class="op">=</span>request.endpoint,</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>                timestamp<span class="op">=</span>datetime.utcnow()</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> result</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> decorated_function</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> decorator</span></code></pre></div>
<h3 data-number="1.5.5" id="data-encryption"><span
class="header-section-number">1.5.5</span> Data Encryption</h3>
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># backend_app/utils/encryption.py</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cryptography.fernet <span class="im">import</span> Fernet</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> base64</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DataEncryption:</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, key: <span class="bu">str</span>):</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fernet <span class="op">=</span> Fernet(key.encode())</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> encrypt_pii(<span class="va">self</span>, data: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Encrypt personally identifiable information&quot;&quot;&quot;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        encrypted_data <span class="op">=</span> <span class="va">self</span>.fernet.encrypt(data.encode())</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> base64.b64encode(encrypted_data).decode()</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> decrypt_pii(<span class="va">self</span>, encrypted_data: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Decrypt personally identifiable information&quot;&quot;&quot;</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        decoded_data <span class="op">=</span> base64.b64decode(encrypted_data.encode())</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        decrypted_data <span class="op">=</span> <span class="va">self</span>.fernet.decrypt(decoded_data)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> decrypted_data.decode()</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> encrypt_file(<span class="va">self</span>, file_data: <span class="bu">bytes</span>) <span class="op">-&gt;</span> <span class="bu">bytes</span>:</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Encrypt file data&quot;&quot;&quot;</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.fernet.encrypt(file_data)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> decrypt_file(<span class="va">self</span>, encrypted_file_data: <span class="bu">bytes</span>) <span class="op">-&gt;</span> <span class="bu">bytes</span>:</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Decrypt file data&quot;&quot;&quot;</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.fernet.decrypt(encrypted_file_data)</span></code></pre></div>
<h2 data-number="1.6" id="ml-service-development"><span
class="header-section-number">1.6</span> ML Service Development</h2>
<h3 data-number="1.6.1" id="architecture"><span
class="header-section-number">1.6.1</span> Architecture</h3>
<p>The ML service is built with FastAPI and includes:</p>
<ul>
<li><strong>Real-time image processing</strong> using OpenCV</li>
<li><strong>Pose estimation</strong> with MediaPipe</li>
<li><strong>Anthropometric calculations</strong> from body
landmarks</li>
<li><strong>WHO growth standards</strong> integration</li>
<li><strong>Confidence scoring</strong> and quality assessment</li>
</ul>
<h3 data-number="1.6.2" id="project-structure-2"><span
class="header-section-number">1.6.2</span> Project Structure</h3>
<pre><code>ml-service/
├── models/
│   ├── __init__.py
│   ├── anthropometric_predictor.py
│   ├── pose_estimator.py
│   └── who_standards.py
├── utils/
│   ├── __init__.py
│   ├── image_processor.py
│   ├── measurement_calculator.py
│   └── video_processor.py
├── main_real.py           # Production ML service
├── main_minimal.py        # Minimal service for testing
└── requirements-real.txt  # ML dependencies</code></pre>
<h3 data-number="1.6.3" id="real-ml-implementation"><span
class="header-section-number">1.6.3</span> Real ML Implementation</h3>
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># models/anthropometric_predictor.py</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict, Any, Tuple</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RealAnthropometricPredictor:</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.height_model <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.weight_model <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.muac_model <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.head_circumference_model <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._train_models()</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> predict_measurements(<span class="va">self</span>, </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>                           pose_landmarks: np.ndarray, </span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>                           age_months: <span class="bu">int</span>, </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>                           sex: <span class="bu">str</span>, </span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>                           image_metadata: Dict[<span class="bu">str</span>, Any]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="co">        Predict anthropometric measurements from pose landmarks.</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract features from pose landmarks</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>        features <span class="op">=</span> <span class="va">self</span>._extract_features(pose_landmarks, age_months, sex)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Make predictions</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>        height <span class="op">=</span> <span class="va">self</span>.height_model.predict([features])[<span class="dv">0</span>]</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>        weight <span class="op">=</span> <span class="va">self</span>.weight_model.predict([features])[<span class="dv">0</span>]</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>        muac <span class="op">=</span> <span class="va">self</span>.muac_model.predict([features])[<span class="dv">0</span>]</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>        head_circumference <span class="op">=</span> <span class="va">self</span>.head_circumference_model.predict([features])[<span class="dv">0</span>]</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate confidence scores</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>        height_confidence <span class="op">=</span> <span class="va">self</span>._calculate_confidence(features, <span class="st">&#39;height&#39;</span>)</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>        weight_confidence <span class="op">=</span> <span class="va">self</span>._calculate_confidence(features, <span class="st">&#39;weight&#39;</span>)</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>        muac_confidence <span class="op">=</span> <span class="va">self</span>._calculate_confidence(features, <span class="st">&#39;muac&#39;</span>)</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>        hc_confidence <span class="op">=</span> <span class="va">self</span>._calculate_confidence(features, <span class="st">&#39;head_circumference&#39;</span>)</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;height&#39;</span>: {</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;value&#39;</span>: <span class="bu">round</span>(height, <span class="dv">1</span>),</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;unit&#39;</span>: <span class="st">&#39;cm&#39;</span>,</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;confidence&#39;</span>: height_confidence,</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="st">&#39;pose_estimation&#39;</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;weight&#39;</span>: {</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;value&#39;</span>: <span class="bu">round</span>(weight, <span class="dv">2</span>),</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;unit&#39;</span>: <span class="st">&#39;kg&#39;</span>,</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;confidence&#39;</span>: weight_confidence,</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="st">&#39;ml_prediction&#39;</span></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;muac&#39;</span>: {</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;value&#39;</span>: <span class="bu">round</span>(muac, <span class="dv">1</span>),</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;unit&#39;</span>: <span class="st">&#39;cm&#39;</span>,</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;confidence&#39;</span>: muac_confidence,</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="st">&#39;arm_circumference&#39;</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;head_circumference&#39;</span>: {</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;value&#39;</span>: <span class="bu">round</span>(head_circumference, <span class="dv">1</span>),</span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;unit&#39;</span>: <span class="st">&#39;cm&#39;</span>,</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;confidence&#39;</span>: hc_confidence,</span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;method&#39;</span>: <span class="st">&#39;head_detection&#39;</span></span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>        }</span></code></pre></div>
<h3 data-number="1.6.4" id="pose-estimation"><span
class="header-section-number">1.6.4</span> Pose Estimation</h3>
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># models/pose_estimator.py</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mediapipe <span class="im">as</span> mp</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Optional, Tuple, Dict, Any</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RealPoseEstimator:</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.mp_pose <span class="op">=</span> mp.solutions.pose</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.pose <span class="op">=</span> <span class="va">self</span>.mp_pose.Pose(</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>            static_image_mode<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>            model_complexity<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>            enable_segmentation<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>            min_detection_confidence<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>            min_tracking_confidence<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.mp_drawing <span class="op">=</span> mp.solutions.drawing_utils</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> estimate_pose(<span class="va">self</span>, image: np.ndarray) <span class="op">-&gt;</span> Tuple[Optional[np.ndarray], <span class="bu">float</span>, Dict[<span class="bu">str</span>, Any]]:</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co">        Estimate pose from input image and return landmarks with confidence.</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert BGR to RGB</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>        rgb_image <span class="op">=</span> cv2.cvtColor(image, cv2.COLOR_BGR2RGB)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process the image</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> <span class="va">self</span>.pose.process(rgb_image)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> results.pose_landmarks:</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extract landmark coordinates</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>            landmarks <span class="op">=</span> []</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> landmark <span class="kw">in</span> results.pose_landmarks.landmark:</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>                landmarks.extend([landmark.x, landmark.y, landmark.z, landmark.visibility])</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>            landmarks_array <span class="op">=</span> np.array(landmarks).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calculate overall confidence</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>            confidence <span class="op">=</span> np.mean(landmarks_array[:, <span class="dv">3</span>])  <span class="co"># Average visibility scores</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extract key measurements</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>            measurements <span class="op">=</span> <span class="va">self</span>._extract_key_measurements(landmarks_array, image.shape)</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> landmarks_array, confidence, measurements</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="fl">0.0</span>, {}</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _extract_key_measurements(<span class="va">self</span>, landmarks: np.ndarray, image_shape: Tuple[<span class="bu">int</span>, <span class="bu">int</span>, <span class="bu">int</span>]) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a><span class="co">        Extract key body measurements from pose landmarks.</span></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>        height, width <span class="op">=</span> image_shape[:<span class="dv">2</span>]</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Key landmark indices (MediaPipe pose landmarks)</span></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>        NOSE <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>        LEFT_SHOULDER <span class="op">=</span> <span class="dv">11</span></span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>        RIGHT_SHOULDER <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>        LEFT_HIP <span class="op">=</span> <span class="dv">23</span></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>        RIGHT_HIP <span class="op">=</span> <span class="dv">24</span></span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>        LEFT_ANKLE <span class="op">=</span> <span class="dv">27</span></span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>        RIGHT_ANKLE <span class="op">=</span> <span class="dv">28</span></span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>        measurements <span class="op">=</span> {}</span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate body height (nose to average ankle)</span></span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">all</span>(landmarks[i, <span class="dv">3</span>] <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="cf">for</span> i <span class="kw">in</span> [NOSE, LEFT_ANKLE, RIGHT_ANKLE]):</span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>            nose_y <span class="op">=</span> landmarks[NOSE, <span class="dv">1</span>] <span class="op">*</span> height</span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>            avg_ankle_y <span class="op">=</span> (landmarks[LEFT_ANKLE, <span class="dv">1</span>] <span class="op">+</span> landmarks[RIGHT_ANKLE, <span class="dv">1</span>]) <span class="op">/</span> <span class="dv">2</span> <span class="op">*</span> height</span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>            body_height_pixels <span class="op">=</span> <span class="bu">abs</span>(avg_ankle_y <span class="op">-</span> nose_y)</span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>            measurements[<span class="st">&#39;body_height_pixels&#39;</span>] <span class="op">=</span> body_height_pixels</span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate shoulder width</span></span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">all</span>(landmarks[i, <span class="dv">3</span>] <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="cf">for</span> i <span class="kw">in</span> [LEFT_SHOULDER, RIGHT_SHOULDER]):</span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a>            shoulder_width_pixels <span class="op">=</span> <span class="bu">abs</span>(</span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>                landmarks[LEFT_SHOULDER, <span class="dv">0</span>] <span class="op">-</span> landmarks[RIGHT_SHOULDER, <span class="dv">0</span>]</span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>            ) <span class="op">*</span> width</span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>            measurements[<span class="st">&#39;shoulder_width_pixels&#39;</span>] <span class="op">=</span> shoulder_width_pixels</span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate torso length</span></span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">all</span>(landmarks[i, <span class="dv">3</span>] <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="cf">for</span> i <span class="kw">in</span> [LEFT_SHOULDER, RIGHT_SHOULDER, LEFT_HIP, RIGHT_HIP]):</span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a>            avg_shoulder_y <span class="op">=</span> (landmarks[LEFT_SHOULDER, <span class="dv">1</span>] <span class="op">+</span> landmarks[RIGHT_SHOULDER, <span class="dv">1</span>]) <span class="op">/</span> <span class="dv">2</span> <span class="op">*</span> height</span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a>            avg_hip_y <span class="op">=</span> (landmarks[LEFT_HIP, <span class="dv">1</span>] <span class="op">+</span> landmarks[RIGHT_HIP, <span class="dv">1</span>]) <span class="op">/</span> <span class="dv">2</span> <span class="op">*</span> height</span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a>            torso_length_pixels <span class="op">=</span> <span class="bu">abs</span>(avg_hip_y <span class="op">-</span> avg_shoulder_y)</span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a>            measurements[<span class="st">&#39;torso_length_pixels&#39;</span>] <span class="op">=</span> torso_length_pixels</span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> measurements</span></code></pre></div>
<h3 data-number="1.6.5" id="who-growth-standards-integration"><span
class="header-section-number">1.6.5</span> WHO Growth Standards
Integration</h3>
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># models/who_standards.py</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict, Any, Optional</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> WHOGrowthStandards:</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, standards_path: <span class="bu">str</span> <span class="op">=</span> <span class="st">&quot;data/who_standards.json&quot;</span>):</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.standards <span class="op">=</span> <span class="va">self</span>._load_standards(standards_path)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> calculate_z_scores(<span class="va">self</span>, </span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>                          measurements: Dict[<span class="bu">str</span>, <span class="bu">float</span>], </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>                          age_months: <span class="bu">int</span>, </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>                          sex: <span class="bu">str</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co">        Calculate Z-scores based on WHO growth standards.</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>        sex_key <span class="op">=</span> <span class="st">&#39;boys&#39;</span> <span class="cf">if</span> sex.upper() <span class="op">==</span> <span class="st">&#39;M&#39;</span> <span class="cf">else</span> <span class="st">&#39;girls&#39;</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> {}</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Height-for-age Z-score (stunting indicator)</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;height&#39;</span> <span class="kw">in</span> measurements:</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>            height_z <span class="op">=</span> <span class="va">self</span>._calculate_height_for_age_z(</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>                measurements[<span class="st">&#39;height&#39;</span>], age_months, sex_key</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>            results[<span class="st">&#39;height_for_age_z&#39;</span>] <span class="op">=</span> height_z</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>            results[<span class="st">&#39;stunting_status&#39;</span>] <span class="op">=</span> <span class="va">self</span>._classify_stunting(height_z)</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Weight-for-height Z-score (wasting indicator)</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;weight&#39;</span> <span class="kw">in</span> measurements <span class="kw">and</span> <span class="st">&#39;height&#39;</span> <span class="kw">in</span> measurements:</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>            weight_height_z <span class="op">=</span> <span class="va">self</span>._calculate_weight_for_height_z(</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>                measurements[<span class="st">&#39;weight&#39;</span>], measurements[<span class="st">&#39;height&#39;</span>], sex_key</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>            results[<span class="st">&#39;weight_for_height_z&#39;</span>] <span class="op">=</span> weight_height_z</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>            results[<span class="st">&#39;wasting_status&#39;</span>] <span class="op">=</span> <span class="va">self</span>._classify_wasting(weight_height_z)</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Weight-for-age Z-score (underweight indicator)</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;weight&#39;</span> <span class="kw">in</span> measurements:</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>            weight_age_z <span class="op">=</span> <span class="va">self</span>._calculate_weight_for_age_z(</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>                measurements[<span class="st">&#39;weight&#39;</span>], age_months, sex_key</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>            results[<span class="st">&#39;weight_for_age_z&#39;</span>] <span class="op">=</span> weight_age_z</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>            results[<span class="st">&#39;underweight_status&#39;</span>] <span class="op">=</span> <span class="va">self</span>._classify_underweight(weight_age_z)</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> results</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _classify_stunting(<span class="va">self</span>, z_score: <span class="bu">float</span>) <span class="op">-&gt;</span> Dict[<span class="bu">str</span>, Any]:</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Classify stunting severity based on height-for-age Z-score.&quot;&quot;&quot;</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> z_score <span class="op">&gt;=</span> <span class="op">-</span><span class="dv">2</span>:</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> <span class="st">&#39;normal&#39;</span></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>            risk_level <span class="op">=</span> <span class="st">&#39;low&#39;</span></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> z_score <span class="op">&gt;=</span> <span class="op">-</span><span class="dv">3</span>:</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> <span class="st">&#39;moderate&#39;</span></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>            risk_level <span class="op">=</span> <span class="st">&#39;medium&#39;</span></span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> <span class="st">&#39;severe&#39;</span></span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>            risk_level <span class="op">=</span> <span class="st">&#39;high&#39;</span></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;status&#39;</span>: status,</span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;z_score&#39;</span>: <span class="bu">round</span>(z_score, <span class="dv">2</span>),</span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;risk_level&#39;</span>: risk_level</span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>        }</span></code></pre></div>
<h3 data-number="1.6.6" id="fastapi-service-implementation"><span
class="header-section-number">1.6.6</span> FastAPI Service
Implementation</h3>
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># main_real.py</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI, HTTPException, BackgroundTasks</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi.middleware.cors <span class="im">import</span> CORSMiddleware</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> uvicorn</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI(</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">&quot;Child Growth Monitor ML Service - Real Implementation&quot;</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    description<span class="op">=</span><span class="st">&quot;Production-ready anthropometric analysis using computer vision&quot;</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    version<span class="op">=</span><span class="st">&quot;3.0.0-real&quot;</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co"># CORS middleware</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>app.add_middleware(</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    CORSMiddleware,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    allow_origins<span class="op">=</span>[<span class="st">&quot;http://localhost:3000&quot;</span>, <span class="st">&quot;http://localhost:5002&quot;</span>, <span class="st">&quot;http://localhost:19006&quot;</span>],</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    allow_credentials<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    allow_methods<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    allow_headers<span class="op">=</span>[<span class="st">&quot;*&quot;</span>],</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Pydantic models</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AnalysisRequest(BaseModel):</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    image_data: <span class="bu">str</span>  <span class="co"># Base64 encoded image</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    age_months: Optional[<span class="bu">int</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>    sex: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span>  <span class="co"># &#39;M&#39; or &#39;F&#39;</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    reference_object_size_cm: Optional[<span class="bu">float</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="at">@app.post</span>(<span class="st">&quot;/analyze&quot;</span>)</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> analyze_image(request: AnalysisRequest, background_tasks: BackgroundTasks):</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="co">    Analyze child image for anthropometric measurements.</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    start_time <span class="op">=</span> time.time()</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Decode base64 image</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>        image_data <span class="op">=</span> base64.b64decode(request.image_data)</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> Image.<span class="bu">open</span>(io.BytesIO(image_data))</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>        cv_image <span class="op">=</span> cv2.cvtColor(np.array(image), cv2.COLOR_RGB2BGR)</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Estimate pose</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>        landmarks, pose_confidence, pose_measurements <span class="op">=</span> pose_estimator.estimate_pose(cv_image)</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> landmarks <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> HTTPException(status_code<span class="op">=</span><span class="dv">400</span>, detail<span class="op">=</span><span class="st">&quot;No pose detected in image&quot;</span>)</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Predict anthropometric measurements</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>        measurements <span class="op">=</span> anthropometric_predictor.predict_measurements(</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>            landmarks, </span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>            request.age_months <span class="kw">or</span> <span class="dv">24</span>, </span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>            request.sex <span class="kw">or</span> <span class="st">&#39;M&#39;</span>,</span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>            {<span class="st">&#39;image_shape&#39;</span>: cv_image.shape}</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate WHO Z-scores if age and sex provided</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>        nutritional_status <span class="op">=</span> {}</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> request.age_months <span class="kw">and</span> request.sex:</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>            who_results <span class="op">=</span> who_standards.calculate_z_scores(</span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>                {k: v[<span class="st">&#39;value&#39;</span>] <span class="cf">for</span> k, v <span class="kw">in</span> measurements.items()},</span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>                request.age_months,</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>                request.sex</span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>            nutritional_status <span class="op">=</span> format_nutritional_status(who_results)</span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>        processing_time <span class="op">=</span> (time.time() <span class="op">-</span> start_time) <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;success&quot;</span>: <span class="va">True</span>,</span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;measurements&quot;</span>: measurements,</span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;nutritional_status&quot;</span>: nutritional_status,</span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;pose_data&quot;</span>: {</span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;landmarks_detected&quot;</span>: <span class="bu">len</span>(landmarks),</span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;pose_confidence&quot;</span>: <span class="bu">float</span>(pose_confidence),</span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;key_measurements&quot;</span>: pose_measurements</span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;confidence_score&quot;</span>: <span class="bu">float</span>(pose_confidence),</span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;processing_time_ms&quot;</span>: processing_time,</span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;model_info&quot;</span>: {</span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;version&quot;</span>: <span class="st">&quot;3.0.0-real&quot;</span>,</span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;algorithms&quot;</span>: [<span class="st">&quot;MediaPipe&quot;</span>, <span class="st">&quot;RandomForest&quot;</span>, <span class="st">&quot;WHO-Standards&quot;</span>],</span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;confidence_threshold&quot;</span>: <span class="fl">0.7</span></span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a>        logger.error(<span class="ss">f&quot;Analysis failed: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> HTTPException(status_code<span class="op">=</span><span class="dv">500</span>, detail<span class="op">=</span><span class="ss">f&quot;Analysis failed: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a>    uvicorn.run(app, host<span class="op">=</span><span class="st">&quot;0.0.0.0&quot;</span>, port<span class="op">=</span><span class="dv">8001</span>, <span class="bu">reload</span><span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<h2 data-number="1.7" id="database-management"><span
class="header-section-number">1.7</span> Database Management</h2>
<h3 data-number="1.7.1" id="schema-design"><span
class="header-section-number">1.7.1</span> Schema Design</h3>
<div class="sourceCode" id="cb26"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- User management</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> organizations (</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    name <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    country <span class="dt">VARCHAR</span>(<span class="dv">100</span>),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW()</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> users (</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    username <span class="dt">VARCHAR</span>(<span class="dv">100</span>) <span class="kw">UNIQUE</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    email <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">UNIQUE</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    password_hash <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">role</span> <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    organization_id UUID <span class="kw">REFERENCES</span> organizations(<span class="kw">id</span>),</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    last_login <span class="dt">TIMESTAMP</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co">-- Child data (with encryption)</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> children (</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    name_encrypted TEXT <span class="kw">NOT</span> <span class="kw">NULL</span>,  <span class="co">-- Encrypted PII</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    date_of_birth_encrypted TEXT <span class="kw">NOT</span> <span class="kw">NULL</span>,  <span class="co">-- Encrypted PII</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>    gender <span class="dt">CHAR</span>(<span class="dv">1</span>) <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">CHECK</span> (gender <span class="kw">IN</span> (<span class="st">&#39;M&#39;</span>, <span class="st">&#39;F&#39;</span>)),</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>    organization_id UUID <span class="kw">REFERENCES</span> organizations(<span class="kw">id</span>),</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    created_by UUID <span class="kw">REFERENCES</span> users(<span class="kw">id</span>),</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>    updated_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW()</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="co">-- Consent management</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> consents (</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>    child_id UUID <span class="kw">REFERENCES</span> children(<span class="kw">id</span>),</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>    guardian_name_encrypted TEXT <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>    consent_type <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>    consent_given <span class="dt">BOOLEAN</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>    digital_signature TEXT,</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>    consent_date <span class="dt">TIMESTAMP</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>    expires_at <span class="dt">TIMESTAMP</span>,</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>    qr_code_data TEXT,</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW()</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a><span class="co">-- Scan sessions</span></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> scan_sessions (</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>    child_id UUID <span class="kw">REFERENCES</span> children(<span class="kw">id</span>),</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>    consent_id UUID <span class="kw">REFERENCES</span> consents(<span class="kw">id</span>),</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>    session_type <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>    status <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>    created_by UUID <span class="kw">REFERENCES</span> users(<span class="kw">id</span>),</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>    completed_at <span class="dt">TIMESTAMP</span></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a><span class="co">-- Measurements and analysis</span></span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> anthropometric_measurements (</span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>    scan_session_id UUID <span class="kw">REFERENCES</span> scan_sessions(<span class="kw">id</span>),</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>    measurement_type <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">value</span> <span class="dt">DECIMAL</span>(<span class="dv">10</span>,<span class="dv">3</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a>    unit <span class="dt">VARCHAR</span>(<span class="dv">10</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a>    confidence_score <span class="dt">DECIMAL</span>(<span class="dv">5</span>,<span class="dv">3</span>),</span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a>    z_score <span class="dt">DECIMAL</span>(<span class="dv">5</span>,<span class="dv">2</span>),</span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a>    percentile <span class="dt">DECIMAL</span>(<span class="dv">5</span>,<span class="dv">2</span>),</span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a>    measurement_method <span class="dt">VARCHAR</span>(<span class="dv">50</span>),</span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW()</span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a>);</span></code></pre></div>
<h3 data-number="1.7.2" id="database-initialization"><span
class="header-section-number">1.7.2</span> Database Initialization</h3>
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># init_db.py</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> click</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask.cli <span class="im">import</span> with_appcontext</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> backend_app <span class="im">import</span> create_app</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> backend_app.extensions <span class="im">import</span> db</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> init_database():</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Initialize the database with tables and initial data.&quot;&quot;&quot;</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    db.create_all()</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create default organization</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> backend_app.models.organization <span class="im">import</span> Organization</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    default_org <span class="op">=</span> Organization(</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">&quot;Development Organization&quot;</span>,</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        country<span class="op">=</span><span class="st">&quot;US&quot;</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    db.session.add(default_org)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create admin user</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> backend_app.models.user <span class="im">import</span> User</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    admin_user <span class="op">=</span> User(</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>        username<span class="op">=</span><span class="st">&quot;admin&quot;</span>,</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>        email<span class="op">=</span><span class="st">&quot;admin@childgrowthmonitor.org&quot;</span>,</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>        role<span class="op">=</span><span class="st">&quot;admin&quot;</span>,</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>        organization_id<span class="op">=</span>default_org.<span class="bu">id</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    admin_user.set_password(<span class="st">&quot;admin123&quot;</span>)</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    db.session.add(admin_user)</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    db.session.commit()</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    click.echo(<span class="st">&quot;Database initialized successfully!&quot;</span>)</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="at">@click.command</span>()</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="at">@click.option</span>(<span class="st">&#39;--drop&#39;</span>, is_flag<span class="op">=</span><span class="va">True</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&#39;Drop all tables first&#39;</span>)</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> init_db(drop):</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Initialize the database.&quot;&quot;&quot;</span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> drop:</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>        db.drop_all()</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>        click.echo(<span class="st">&quot;Dropped all tables.&quot;</span>)</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>    init_database()</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>    app <span class="op">=</span> create_app()</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> app.app_context():</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>        init_db()</span></code></pre></div>
<h3 data-number="1.7.3" id="migrations"><span
class="header-section-number">1.7.3</span> Migrations</h3>
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Database migration management</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask_migrate <span class="im">import</span> Migrate, upgrade, init, migrate</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> setup_migrations(app, db):</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Setup Flask-Migrate for database migrations.&quot;&quot;&quot;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    migrate <span class="op">=</span> Migrate(app, db)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> migrate</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Migration commands</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run_migrations():</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Run database migrations.&quot;&quot;&quot;</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    upgrade()</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_migration(message):</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Create a new migration.&quot;&quot;&quot;</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    migrate(message<span class="op">=</span>message)</span></code></pre></div>
<h2 data-number="1.8" id="security-implementation"><span
class="header-section-number">1.8</span> Security Implementation</h2>
<h3 data-number="1.8.1" id="data-encryption-1"><span
class="header-section-number">1.8.1</span> Data Encryption</h3>
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Encryption utilities</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cryptography.fernet <span class="im">import</span> Fernet</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> base64</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SecurityManager:</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.encryption_key <span class="op">=</span> os.getenv(<span class="st">&#39;ENCRYPTION_KEY&#39;</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.encryption_key:</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;ENCRYPTION_KEY environment variable not set&quot;</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fernet <span class="op">=</span> Fernet(<span class="va">self</span>.encryption_key.encode())</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> encrypt_sensitive_data(<span class="va">self</span>, data: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Encrypt sensitive data like PII.&quot;&quot;&quot;</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>        encrypted_data <span class="op">=</span> <span class="va">self</span>.fernet.encrypt(data.encode())</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> base64.b64encode(encrypted_data).decode()</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> decrypt_sensitive_data(<span class="va">self</span>, encrypted_data: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Decrypt sensitive data.&quot;&quot;&quot;</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>        decoded_data <span class="op">=</span> base64.b64decode(encrypted_data.encode())</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>        decrypted_data <span class="op">=</span> <span class="va">self</span>.fernet.decrypt(decoded_data)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> decrypted_data.decode()</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> hash_password(<span class="va">self</span>, password: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Hash password for storage.&quot;&quot;&quot;</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> werkzeug.security <span class="im">import</span> generate_password_hash</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> generate_password_hash(password)</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> verify_password(<span class="va">self</span>, password: <span class="bu">str</span>, password_hash: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Verify password against hash.&quot;&quot;&quot;</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> werkzeug.security <span class="im">import</span> check_password_hash</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> check_password_hash(password_hash, password)</span></code></pre></div>
<h3 data-number="1.8.2" id="authentication-authorization"><span
class="header-section-number">1.8.2</span> Authentication &amp;
Authorization</h3>
<div class="sourceCode" id="cb30"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># JWT token management</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask_jwt_extended <span class="im">import</span> JWTManager, create_access_token, get_jwt_identity</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AuthManager:</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, app):</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.jwt <span class="op">=</span> JWTManager(app)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>        app.config[<span class="st">&#39;JWT_SECRET_KEY&#39;</span>] <span class="op">=</span> os.getenv(<span class="st">&#39;JWT_SECRET_KEY&#39;</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        app.config[<span class="st">&#39;JWT_ACCESS_TOKEN_EXPIRES&#39;</span>] <span class="op">=</span> datetime.timedelta(hours<span class="op">=</span><span class="dv">24</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_token(<span class="va">self</span>, user_id: <span class="bu">str</span>, user_data: <span class="bu">dict</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Create JWT token for user.&quot;&quot;&quot;</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>        additional_claims <span class="op">=</span> {</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;user_id&quot;</span>: user_id,</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;role&quot;</span>: user_data.get(<span class="st">&#39;role&#39;</span>),</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;organization_id&quot;</span>: user_data.get(<span class="st">&#39;organization_id&#39;</span>)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> create_access_token(</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>            identity<span class="op">=</span>user_id,</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>            additional_claims<span class="op">=</span>additional_claims</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> require_permission(<span class="va">self</span>, permission: <span class="bu">str</span>):</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Decorator to require specific permission.&quot;&quot;&quot;</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> decorator(f):</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">@wraps</span>(f)</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">def</span> decorated_function(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>                current_user <span class="op">=</span> get_jwt_identity()</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.has_permission(current_user, permission):</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> jsonify({<span class="st">&#39;error&#39;</span>: <span class="st">&#39;Insufficient permissions&#39;</span>}), <span class="dv">403</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> f(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> decorated_function</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> decorator</span></code></pre></div>
<h3 data-number="1.8.3" id="audit-logging"><span
class="header-section-number">1.8.3</span> Audit Logging</h3>
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Audit trail implementation</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AuditLogger:</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, db):</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.db <span class="op">=</span> db</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> log_action(<span class="va">self</span>, user_id: <span class="bu">str</span>, action: <span class="bu">str</span>, resource: <span class="bu">str</span>, </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>                   resource_id: <span class="bu">str</span> <span class="op">=</span> <span class="va">None</span>, details: <span class="bu">dict</span> <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Log user actions for audit trail.&quot;&quot;&quot;</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>        audit_log <span class="op">=</span> AuditLog(</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>            user_id<span class="op">=</span>user_id,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>            action<span class="op">=</span>action,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>            resource<span class="op">=</span>resource,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>            resource_id<span class="op">=</span>resource_id,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>            details<span class="op">=</span>json.dumps(details) <span class="cf">if</span> details <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>            timestamp<span class="op">=</span>datetime.utcnow(),</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>            ip_address<span class="op">=</span>request.remote_addr,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>            user_agent<span class="op">=</span>request.headers.get(<span class="st">&#39;User-Agent&#39;</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.db.session.add(audit_log)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.db.session.commit()</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_audit_trail(<span class="va">self</span>, user_id: <span class="bu">str</span> <span class="op">=</span> <span class="va">None</span>, </span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>                       start_date: datetime <span class="op">=</span> <span class="va">None</span>, </span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>                       end_date: datetime <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Retrieve audit trail with filters.&quot;&quot;&quot;</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>        query <span class="op">=</span> AuditLog.query</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> user_id:</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>            query <span class="op">=</span> query.filter_by(user_id<span class="op">=</span>user_id)</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> start_date:</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>            query <span class="op">=</span> query.<span class="bu">filter</span>(AuditLog.timestamp <span class="op">&gt;=</span> start_date)</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> end_date:</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>            query <span class="op">=</span> query.<span class="bu">filter</span>(AuditLog.timestamp <span class="op">&lt;=</span> end_date)</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> query.order_by(AuditLog.timestamp.desc()).<span class="bu">all</span>()</span></code></pre></div>
<h2 data-number="1.9" id="testing-strategies"><span
class="header-section-number">1.9</span> Testing Strategies</h2>
<h3 data-number="1.9.1" id="unit-testing"><span
class="header-section-number">1.9.1</span> Unit Testing</h3>
<div class="sourceCode" id="cb32"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test_anthropometric_predictor.py</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> unittest</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ml_service.models.anthropometric_predictor <span class="im">import</span> RealAnthropometricPredictor</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TestAnthropometricPredictor(unittest.TestCase):</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> setUp(<span class="va">self</span>):</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.predictor <span class="op">=</span> RealAnthropometricPredictor()</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Sample pose landmarks (33 landmarks x 4 coordinates)</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sample_landmarks <span class="op">=</span> np.random.rand(<span class="dv">33</span>, <span class="dv">4</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sample_landmarks[:, <span class="dv">3</span>] <span class="op">=</span> <span class="fl">0.8</span>  <span class="co"># Set visibility scores</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_predict_measurements_male_toddler(<span class="va">self</span>):</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Test predictions for male toddler.&quot;&quot;&quot;</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>        measurements <span class="op">=</span> <span class="va">self</span>.predictor.predict_measurements(</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.sample_landmarks, </span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>            age_months<span class="op">=</span><span class="dv">24</span>, </span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>            sex<span class="op">=</span><span class="st">&#39;M&#39;</span>,</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>            image_metadata<span class="op">=</span>{<span class="st">&#39;image_shape&#39;</span>: (<span class="dv">480</span>, <span class="dv">640</span>, <span class="dv">3</span>)}</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verify all expected measurements are present</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>        expected_keys <span class="op">=</span> [<span class="st">&#39;height&#39;</span>, <span class="st">&#39;weight&#39;</span>, <span class="st">&#39;muac&#39;</span>, <span class="st">&#39;head_circumference&#39;</span>]</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> key <span class="kw">in</span> expected_keys:</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.assertIn(key, measurements)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.assertIn(<span class="st">&#39;value&#39;</span>, measurements[key])</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.assertIn(<span class="st">&#39;confidence&#39;</span>, measurements[key])</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.assertIn(<span class="st">&#39;unit&#39;</span>, measurements[key])</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verify reasonable ranges for 2-year-old</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertGreater(measurements[<span class="st">&#39;height&#39;</span>][<span class="st">&#39;value&#39;</span>], <span class="dv">70</span>)</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertLess(measurements[<span class="st">&#39;height&#39;</span>][<span class="st">&#39;value&#39;</span>], <span class="dv">120</span>)</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertGreater(measurements[<span class="st">&#39;weight&#39;</span>][<span class="st">&#39;value&#39;</span>], <span class="dv">5</span>)</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertLess(measurements[<span class="st">&#39;weight&#39;</span>][<span class="st">&#39;value&#39;</span>], <span class="dv">25</span>)</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_confidence_scores(<span class="va">self</span>):</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Test confidence score calculations.&quot;&quot;&quot;</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>        measurements <span class="op">=</span> <span class="va">self</span>.predictor.predict_measurements(</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.sample_landmarks, <span class="dv">24</span>, <span class="st">&#39;M&#39;</span>, {}</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> measurement <span class="kw">in</span> measurements.values():</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>            confidence <span class="op">=</span> measurement[<span class="st">&#39;confidence&#39;</span>]</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.assertGreaterEqual(confidence, <span class="fl">0.0</span>)</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.assertLessEqual(confidence, <span class="fl">1.0</span>)</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>    unittest.main()</span></code></pre></div>
<h3 data-number="1.9.2" id="integration-testing"><span
class="header-section-number">1.9.2</span> Integration Testing</h3>
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test_integration.py</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> base64</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> io</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TestMLServiceIntegration:</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">@pytest.fixture</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ml_service_url(<span class="va">self</span>):</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;http://localhost:8001&quot;</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">@pytest.fixture</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sample_image_base64(<span class="va">self</span>):</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Create a sample image and convert to base64.&quot;&quot;&quot;</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a simple test image</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>        img <span class="op">=</span> Image.new(<span class="st">&#39;RGB&#39;</span>, (<span class="dv">640</span>, <span class="dv">480</span>), color<span class="op">=</span><span class="st">&#39;white&#39;</span>)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">buffer</span> <span class="op">=</span> io.BytesIO()</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>        img.save(<span class="bu">buffer</span>, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;PNG&#39;</span>)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>        img_data <span class="op">=</span> <span class="bu">buffer</span>.getvalue()</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> base64.b64encode(img_data).decode()</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_health_endpoint(<span class="va">self</span>, ml_service_url):</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Test ML service health endpoint.&quot;&quot;&quot;</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> requests.get(<span class="ss">f&quot;</span><span class="sc">{</span>ml_service_url<span class="sc">}</span><span class="ss">/health&quot;</span>)</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> response.status_code <span class="op">==</span> <span class="dv">200</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> response.json()</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> data[<span class="st">&#39;status&#39;</span>] <span class="op">==</span> <span class="st">&#39;healthy&#39;</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> data[<span class="st">&#39;models_loaded&#39;</span>] <span class="kw">is</span> <span class="va">True</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_analyze_endpoint(<span class="va">self</span>, ml_service_url, sample_image_base64):</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Test image analysis endpoint.&quot;&quot;&quot;</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>        payload <span class="op">=</span> {</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;image_data&#39;</span>: sample_image_base64,</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;age_months&#39;</span>: <span class="dv">24</span>,</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;sex&#39;</span>: <span class="st">&#39;M&#39;</span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> requests.post(</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;</span><span class="sc">{</span>ml_service_url<span class="sc">}</span><span class="ss">/analyze&quot;</span>,</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>            json<span class="op">=</span>payload,</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>            headers<span class="op">=</span>{<span class="st">&#39;Content-Type&#39;</span>: <span class="st">&#39;application/json&#39;</span>}</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> response.status_code <span class="op">==</span> <span class="dv">200</span></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> response.json()</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verify response structure</span></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> <span class="st">&#39;success&#39;</span> <span class="kw">in</span> data</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> <span class="st">&#39;measurements&#39;</span> <span class="kw">in</span> data</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> <span class="st">&#39;processing_time_ms&#39;</span> <span class="kw">in</span> data</span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verify measurements structure</span></span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>        measurements <span class="op">=</span> data[<span class="st">&#39;measurements&#39;</span>]</span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> measurement_type <span class="kw">in</span> [<span class="st">&#39;height&#39;</span>, <span class="st">&#39;weight&#39;</span>, <span class="st">&#39;muac&#39;</span>, <span class="st">&#39;head_circumference&#39;</span>]:</span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">assert</span> measurement_type <span class="kw">in</span> measurements</span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>            measurement <span class="op">=</span> measurements[measurement_type]</span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">assert</span> <span class="st">&#39;value&#39;</span> <span class="kw">in</span> measurement</span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">assert</span> <span class="st">&#39;unit&#39;</span> <span class="kw">in</span> measurement</span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">assert</span> <span class="st">&#39;confidence&#39;</span> <span class="kw">in</span> measurement</span></code></pre></div>
<h3 data-number="1.9.3" id="end-to-end-testing"><span
class="header-section-number">1.9.3</span> End-to-End Testing</h3>
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test_e2e.py</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium <span class="im">import</span> webdriver</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> selenium.webdriver.common.by <span class="im">import</span> By</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TestMobileAppE2E:</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">@pytest.fixture</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> driver(<span class="va">self</span>):</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>        options <span class="op">=</span> webdriver.ChromeOptions()</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>        options.add_argument(<span class="st">&#39;--headless&#39;</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>        driver <span class="op">=</span> webdriver.Chrome(options<span class="op">=</span>options)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>        driver.get(<span class="st">&#39;http://localhost:19006&#39;</span>)  <span class="co"># Expo web app</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> driver</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>        driver.quit()</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_complete_workflow(<span class="va">self</span>, driver):</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Test complete child assessment workflow.&quot;&quot;&quot;</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Wait for app to load</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">3</span>)</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Navigate to child registration</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>        register_button <span class="op">=</span> driver.find_element(By.TEXT, <span class="st">&quot;Add New Child&quot;</span>)</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>        register_button.click()</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Fill child information</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>        name_input <span class="op">=</span> driver.find_element(By.PLACEHOLDER_TEXT, <span class="st">&quot;Child&#39;s name&quot;</span>)</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>        name_input.send_keys(<span class="st">&quot;Test Child&quot;</span>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Continue with consent and scanning...</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># This would be expanded for full E2E testing</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> <span class="st">&quot;Child Growth Monitor&quot;</span> <span class="kw">in</span> driver.title</span></code></pre></div>
<h2 data-number="1.10" id="deployment-guide"><span
class="header-section-number">1.10</span> Deployment Guide</h2>
<h3 data-number="1.10.1" id="docker-configuration"><span
class="header-section-number">1.10.1</span> Docker Configuration</h3>
<div class="sourceCode" id="cb35"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dockerfile.mobile-app</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> node:16-alpine</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> package*.json ./</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">npm</span> install</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> . .</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPOSE</span> 19006</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">&quot;npm&quot;</span>, <span class="st">&quot;run&quot;</span>, <span class="st">&quot;web&quot;</span>]</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dockerfile.backend</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> python:3.9-slim</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Install system dependencies</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> <span class="dt">\</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    postgresql-client <span class="dt">\</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> <span class="at">-rf</span> /var/lib/apt/lists/<span class="pp">*</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> requirements.txt .</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip</span> install <span class="at">-r</span> requirements.txt</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> . .</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPOSE</span> 5002</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">&quot;python&quot;</span>, <span class="st">&quot;app.py&quot;</span>]</span></code></pre></div>
<div class="sourceCode" id="cb37"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dockerfile.ml-service</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> python:3.9-slim</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Install system dependencies for OpenCV</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> <span class="dt">\</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    libgl1-mesa-glx <span class="dt">\</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    libglib2.0-0 <span class="dt">\</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    libsm6 <span class="dt">\</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    libxext6 <span class="dt">\</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    libxrender-dev <span class="dt">\</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    libgomp1 <span class="dt">\</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> <span class="at">-rf</span> /var/lib/apt/lists/<span class="pp">*</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> requirements-real.txt .</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip</span> install <span class="at">-r</span> requirements-real.txt</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> . .</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPOSE</span> 8001</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">&quot;python&quot;</span>, <span class="st">&quot;main_real.py&quot;</span>]</span></code></pre></div>
<h3 data-number="1.10.2" id="docker-compose"><span
class="header-section-number">1.10.2</span> Docker Compose</h3>
<div class="sourceCode" id="cb38"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># docker-compose.yml</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.8&#39;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">database</span><span class="kw">:</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> postgres:13</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_DB</span><span class="kw">:</span><span class="at"> cgm_db</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_USER</span><span class="kw">:</span><span class="at"> cgm_user</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_PASSWORD</span><span class="kw">:</span><span class="at"> cgm_password</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgres_data:/var/lib/postgresql/data</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;5432:5432&quot;</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">backend</span><span class="kw">:</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> ./backend</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">DATABASE_URL</span><span class="kw">:</span><span class="at"> postgresql://cgm_user:cgm_password@database:5432/cgm_db</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">FLASK_ENV</span><span class="kw">:</span><span class="at"> production</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;5002:5002&quot;</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> database</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">ml-service</span><span class="kw">:</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> ./ml-service</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8001:8001&quot;</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ml_models:/app/models</span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">mobile-app</span><span class="kw">:</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> ./mobile-app</span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;19006:19006&quot;</span></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">API_BASE_URL</span><span class="kw">:</span><span class="at"> http://backend:5002/api</span></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">ML_SERVICE_URL</span><span class="kw">:</span><span class="at"> http://ml-service:8001</span></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">postgres_data</span><span class="kw">:</span></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">ml_models</span><span class="kw">:</span></span></code></pre></div>
<h3 data-number="1.10.3" id="azure-deployment"><span
class="header-section-number">1.10.3</span> Azure Deployment</h3>
<div class="sourceCode" id="cb39"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># azure-pipelines.yml</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">trigger</span><span class="kw">:</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> main</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">pool</span><span class="kw">:</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vmImage</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;ubuntu-latest&#39;</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="fu">stages</span><span class="kw">:</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> Build</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">job</span><span class="kw">:</span><span class="at"> BuildServices</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">task</span><span class="kw">:</span><span class="at"> Docker@2</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">displayName</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;Build Backend Image&#39;</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">inputs</span><span class="kw">:</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;buildAndPush&#39;</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">repository</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;cgm-backend&#39;</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;backend/Dockerfile&#39;</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">containerRegistry</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;ACRConnection&#39;</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;$(Build.BuildId)&#39;</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">task</span><span class="kw">:</span><span class="at"> Docker@2</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">displayName</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;Build ML Service Image&#39;</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">inputs</span><span class="kw">:</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;buildAndPush&#39;</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">repository</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;cgm-ml-service&#39;</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;ml-service/Dockerfile&#39;</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">containerRegistry</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;ACRConnection&#39;</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;$(Build.BuildId)&#39;</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> Deploy</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">dependsOn</span><span class="kw">:</span><span class="at"> Build</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">deployment</span><span class="kw">:</span><span class="at"> DeployToProduction</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;production&#39;</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">strategy</span><span class="kw">:</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">runOnce</span><span class="kw">:</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">deploy</span><span class="kw">:</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">task</span><span class="kw">:</span><span class="at"> AzureWebAppContainer@1</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">displayName</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;Deploy Backend&#39;</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">inputs</span><span class="kw">:</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">azureSubscription</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;AzureConnection&#39;</span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">appName</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;cgm-backend-prod&#39;</span></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">imageName</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;cgm-backend:$(Build.BuildId)&#39;</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">task</span><span class="kw">:</span><span class="at"> AzureWebAppContainer@1</span></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">displayName</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;Deploy ML Service&#39;</span></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">inputs</span><span class="kw">:</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">azureSubscription</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;AzureConnection&#39;</span></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">appName</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;cgm-ml-service-prod&#39;</span></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">imageName</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;cgm-ml-service:$(Build.BuildId)&#39;</span></span></code></pre></div>
<h3 data-number="1.10.4" id="environment-configuration-1"><span
class="header-section-number">1.10.4</span> Environment
Configuration</h3>
<div class="sourceCode" id="cb40"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Production environment variables</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># backend/.env.production</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="va">FLASK_ENV</span><span class="op">=</span>production</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="va">DATABASE_URL</span><span class="op">=</span>postgresql://user:pass@prod-db:5432/cgm_prod</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="va">SECRET_KEY</span><span class="op">=</span>production-secret-key</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="va">ENCRYPTION_KEY</span><span class="op">=</span>production-encryption-key</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="va">AZURE_STORAGE_ACCOUNT</span><span class="op">=</span>cgmstorageprod</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="va">AZURE_B2C_TENANT</span><span class="op">=</span>cgmb2cprod</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ml-service/.env.production</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="va">MODEL_PATH</span><span class="op">=</span>/app/models</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="va">LOG_LEVEL</span><span class="op">=</span>INFO</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="va">ENABLE_GPU</span><span class="op">=</span>true</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="va">WHO_STANDARDS_PATH</span><span class="op">=</span>/app/data/who_standards.json</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="va">REDIS_URL</span><span class="op">=</span>redis://prod-redis:6379</span></code></pre></div>
<h2 data-number="1.11" id="api-documentation"><span
class="header-section-number">1.11</span> API Documentation</h2>
<h3 data-number="1.11.1" id="authentication-endpoints"><span
class="header-section-number">1.11.1</span> Authentication
Endpoints</h3>
<pre><code>POST /api/auth/login
Content-Type: application/json

{
  &quot;username&quot;: &quot;string&quot;,
  &quot;password&quot;: &quot;string&quot;
}

Response:
{
  &quot;success&quot;: true,
  &quot;token&quot;: &quot;jwt-token&quot;,
  &quot;user&quot;: {
    &quot;id&quot;: &quot;uuid&quot;,
    &quot;username&quot;: &quot;string&quot;,
    &quot;role&quot;: &quot;string&quot;,
    &quot;organization_id&quot;: &quot;uuid&quot;
  }
}</code></pre>
<h3 data-number="1.11.2" id="child-management-endpoints"><span
class="header-section-number">1.11.2</span> Child Management
Endpoints</h3>
<pre><code>POST /api/children
Authorization: Bearer {token}
Content-Type: application/json

{
  &quot;name&quot;: &quot;string&quot;,
  &quot;date_of_birth&quot;: &quot;YYYY-MM-DD&quot;,
  &quot;gender&quot;: &quot;M|F&quot;,
  &quot;guardian_name&quot;: &quot;string&quot;
}

Response:
{
  &quot;success&quot;: true,
  &quot;data&quot;: {
    &quot;id&quot;: &quot;uuid&quot;,
    &quot;name&quot;: &quot;string&quot;,
    &quot;age_months&quot;: 24,
    &quot;gender&quot;: &quot;M&quot;,
    &quot;created_at&quot;: &quot;ISO-8601&quot;
  }
}</code></pre>
<h3 data-number="1.11.3" id="ml-analysis-endpoints"><span
class="header-section-number">1.11.3</span> ML Analysis Endpoints</h3>
<pre><code>POST /analyze
Content-Type: application/json

{
  &quot;image_data&quot;: &quot;base64-encoded-image&quot;,
  &quot;age_months&quot;: 24,
  &quot;sex&quot;: &quot;M&quot;,
  &quot;reference_object_size_cm&quot;: 10.0
}

Response:
{
  &quot;success&quot;: true,
  &quot;measurements&quot;: {
    &quot;height&quot;: {
      &quot;value&quot;: 85.2,
      &quot;unit&quot;: &quot;cm&quot;,
      &quot;confidence&quot;: 0.87
    },
    &quot;weight&quot;: {
      &quot;value&quot;: 12.5,
      &quot;unit&quot;: &quot;kg&quot;,
      &quot;confidence&quot;: 0.82
    }
  },
  &quot;nutritional_status&quot;: {
    &quot;stunting&quot;: {
      &quot;status&quot;: &quot;normal&quot;,
      &quot;z_score&quot;: -1.2,
      &quot;risk_level&quot;: &quot;low&quot;
    }
  },
  &quot;processing_time_ms&quot;: 245.7
}</code></pre>
<h2 data-number="1.12" id="troubleshooting"><span
class="header-section-number">1.12</span> Troubleshooting</h2>
<h3 data-number="1.12.1" id="common-development-issues"><span
class="header-section-number">1.12.1</span> Common Development
Issues</h3>
<h4 data-number="1.12.1.1" id="macos-file-descriptor-limits"><span
class="header-section-number">1.12.1.1</span> macOS File Descriptor
Limits</h4>
<div class="sourceCode" id="cb44"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Increase file descriptor limits</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="bu">ulimit</span> <span class="at">-n</span> 65536</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Permanent fix</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;kern.maxfiles=65536&quot;</span> <span class="kw">|</span> <span class="fu">sudo</span> tee <span class="at">-a</span> /etc/sysctl.conf</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> sysctl <span class="at">-w</span> kern.maxfiles=65536</span></code></pre></div>
<h4 data-number="1.12.1.2" id="react-native-metro-issues"><span
class="header-section-number">1.12.1.2</span> React Native Metro
Issues</h4>
<div class="sourceCode" id="cb45"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clear Metro cache</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> react-native start <span class="at">--reset-cache</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix watchman issues</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install watchman</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="ex">watchman</span> watch-del-all</span></code></pre></div>
<h4 data-number="1.12.1.3" id="python-environment-issues"><span
class="header-section-number">1.12.1.3</span> Python Environment
Issues</h4>
<div class="sourceCode" id="cb46"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recreate virtual environment</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> venv</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">-m</span> venv venv</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> venv/bin/activate</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements.txt</span></code></pre></div>
<h3 data-number="1.12.2" id="performance-optimization"><span
class="header-section-number">1.12.2</span> Performance
Optimization</h3>
<h4 data-number="1.12.2.1" id="mobile-app-optimization"><span
class="header-section-number">1.12.2.1</span> Mobile App
Optimization</h4>
<ul>
<li>Use React.memo for expensive components</li>
<li>Implement lazy loading for screens</li>
<li>Optimize image compression</li>
<li>Use background processing for ML analysis</li>
</ul>
<h4 data-number="1.12.2.2" id="backend-optimization"><span
class="header-section-number">1.12.2.2</span> Backend Optimization</h4>
<ul>
<li>Implement database connection pooling</li>
<li>Add caching with Redis</li>
<li>Use async processing for heavy operations</li>
<li>Optimize database queries with indexes</li>
</ul>
<h4 data-number="1.12.2.3" id="ml-service-optimization"><span
class="header-section-number">1.12.2.3</span> ML Service
Optimization</h4>
<ul>
<li>Use GPU acceleration when available</li>
<li>Implement model caching</li>
<li>Batch processing for multiple images</li>
<li>Optimize image preprocessing</li>
</ul>
<h3 data-number="1.12.3" id="monitoring-and-logging"><span
class="header-section-number">1.12.3</span> Monitoring and Logging</h3>
<div class="sourceCode" id="cb47"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Logging configuration</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> logging.handlers <span class="im">import</span> RotatingFileHandler</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> setup_logging(app):</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> app.debug:</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">&#39;logs&#39;</span>):</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>            os.mkdir(<span class="st">&#39;logs&#39;</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>        file_handler <span class="op">=</span> RotatingFileHandler(</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;logs/cgm.log&#39;</span>, </span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>            maxBytes<span class="op">=</span><span class="dv">10240000</span>, </span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>            backupCount<span class="op">=</span><span class="dv">10</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>        file_handler.setFormatter(logging.Formatter(</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;</span><span class="sc">%(asctime)s</span><span class="st"> </span><span class="sc">%(levelname)s</span><span class="st">: </span><span class="sc">%(message)s</span><span class="st"> [in </span><span class="sc">%(pathname)s</span><span class="st">:</span><span class="sc">%(lineno)d</span><span class="st">]&#39;</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>        file_handler.setLevel(logging.INFO)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>        app.logger.addHandler(file_handler)</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>        app.logger.setLevel(logging.INFO)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>        app.logger.info(<span class="st">&#39;Child Growth Monitor startup&#39;</span>)</span></code></pre></div>
<h2 data-number="1.13" id="contributing-guidelines"><span
class="header-section-number">1.13</span> Contributing Guidelines</h2>
<h3 data-number="1.13.1" id="code-standards"><span
class="header-section-number">1.13.1</span> Code Standards</h3>
<h4 data-number="1.13.1.1" id="python-backend-ml-service"><span
class="header-section-number">1.13.1.1</span> Python (Backend &amp; ML
Service)</h4>
<ul>
<li>Follow PEP 8 style guidelines</li>
<li>Use type hints for all functions</li>
<li>Include docstrings for all public methods</li>
<li>Maximum line length: 88 characters</li>
<li>Use Black for code formatting</li>
</ul>
<h4 data-number="1.13.1.2" id="typescript-mobile-app"><span
class="header-section-number">1.13.1.2</span> TypeScript (Mobile
App)</h4>
<ul>
<li>Use ESLint with strict configuration</li>
<li>Prefer functional components with hooks</li>
<li>Use meaningful variable and function names</li>
<li>Include JSDoc comments for complex functions</li>
</ul>
<h3 data-number="1.13.2" id="git-workflow"><span
class="header-section-number">1.13.2</span> Git Workflow</h3>
<div class="sourceCode" id="cb48"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create feature branch</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> checkout <span class="at">-b</span> feature/new-feature</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make changes and commit</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> add .</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">&quot;feat: add new anthropometric measurement&quot;</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Push and create pull request</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push origin feature/new-feature</span></code></pre></div>
<h3 data-number="1.13.3" id="commit-message-format"><span
class="header-section-number">1.13.3</span> Commit Message Format</h3>
<pre><code>type(scope): description

Types: feat, fix, docs, style, refactor, test, chore
Scope: mobile, backend, ml-service, docs</code></pre>
<h3 data-number="1.13.4" id="pull-request-process"><span
class="header-section-number">1.13.4</span> Pull Request Process</h3>
<ol type="1">
<li>Create feature branch from main</li>
<li>Implement changes with tests</li>
<li>Update documentation if needed</li>
<li>Ensure all tests pass</li>
<li>Request code review</li>
<li>Address feedback</li>
<li>Merge after approval</li>
</ol>
<h3 data-number="1.13.5" id="testing-requirements"><span
class="header-section-number">1.13.5</span> Testing Requirements</h3>
<ul>
<li>All new features must include unit tests</li>
<li>Integration tests for API endpoints</li>
<li>E2E tests for critical user workflows</li>
<li>Minimum 80% code coverage</li>
</ul>
<hr />
<p><strong>Version 3.0.0 - July 2025</strong><br />
<strong>© 2025 Child Growth Monitor Development Team. All rights
reserved.</strong></p>
</body>
</html>
